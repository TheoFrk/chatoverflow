name: Javadoc Deploy

on:
  push:
    branches:
    - master

jobs:
  publish:
    if: startsWith(github.repository, 'codeoverflow-org') # don't run this in forks
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - uses: actions/checkout@v2
      with:
        repository: codeoverflow-org/chatoverflow-api
        path: api

    - uses: actions/checkout@v2
      with:
        repository: codeoverflow-org/chatoverflow-gh-pages
        path: docs

    - uses: olafurpg/setup-scala@v5
      name: Install java & sbt
      with:
        java-version: openjdk@1.8

    - name: Generate documentation
      run: sbt -Dfile.encoding=UTF8 fetch reload update doc

    - name: Copy documentation
      run: bash .scripts/copy-docs.sh

    - uses: docker://peaceiris/gh-pages:v2
        env:
          ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
          PUBLISH_DIR: ./docs
          EXTERNAL_REPOSITORY: codeoverflow-org/chatoverflow-gh-pages
          PUBLISH_BRANCH: master

